import{u as e,c as a}from"./admin-a72e56d8.js";import{u as t}from"./fc-90189d6c.js";import"./vuedraggable.umd-06157e8d.js";import{C as l,A as s,p as o,a as n,b as r,c as u,d as i,L as c,P as d,e as m,B as f,f as v}from"./chartjs-plugin-datalabels.esm-e6c83794.js";import{f as g}from"./timezone-f19b4e1b.js";import{e as h,c as p,n as y,f as N,X as w,r as _,o as k,a as x,w as b,b as I,i as $,h as D,g as T,k as j,F as V,j as C,t as E,m as U}from"./vendor-55a355ca.js";const A={class:"d-flex justify-end mb-2"},O={key:0},z={class:"d-flex align-center",style:{"font-size":"3.4em"}},B={class:"font-weight-bold text-primary"},R={class:"mx-2 font-weight-bold text-warning"},G={class:"font-weight-bold text-error"},F={key:0,class:"ml-2 font-weight-bold text-grey"},L={style:{width:"120px",height:"120px"}},S={class:"text-center"},M={class:"text-h4 font-weight-bold text-primary"},P={class:"d-flex align-center justify-space-between"},q={class:"text-subtitle-1 font-weight-medium"},W={class:"text-caption text-grey-darken-1"},X={class:"text-h6 text-center my-2"},H={class:"text-caption text-center"},J={class:"text-caption text-grey-darken-1 mt-2"},K={key:1,class:"text-center py-8"},Q={class:"text-body-1 text-medium-emphasis"},Y={class:"d-flex justify-center"},Z={__name:"Manager",setup(Z){const ee=e();t();const ae=a.create({baseURL:"localhost"===window.location.hostname?"http://localhost:3000":window.location.origin,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},withCredentials:!0});ae.interceptors.request.use(e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),"get"===e.method&&(e.params={...e.params,_t:Date.now()}),e});const te=(e,a)=>!(!e||!a)&&e.toLowerCase()===a.toLowerCase(),le=["junspapa","junnypapa","절대월클아니다","머니트렌드","마곡아이언맨","마곡퍼터맨"],se=h([]);h("");const oe=h(!1);h(!1),h(!1);const ne=h("");h(0);const re=h(20),ue=[{title:"20게임",value:20},{title:"50게임",value:50},{title:"100게임",value:100}];h(null),h(!1),h(52),h(!1),h([]),h(!1);const ie=h({});p(()=>ee.isAdmin),y(re,async e=>{if(e&&ne.value){const t=se.value.find(e=>e.userName===ne.value);if(t)if(t.ouid||(console.log(`${t.userName}의 OUID가 없어서 사용자 정보 로드`),await we()),t.ouid)try{await fe(t,e)}catch(a){console.log(`${t.userName} 미리 계산된 통계 로드 실패, 실시간 데이터 로드`),await ve(t,!1)}else console.log(`${t.userName}의 OUID가 없어서 실시간 데이터 로드`),await ve(t,!1)}});const ce=()=>{try{const e=le.map(e=>({userName:e,ouid:"",matches:[],stats:null,isDefault:!0}));se.value=e,console.log("기본 닉네임 로드 완료:",se.value.map(e=>({userName:e.userName,ouid:e.ouid}))),se.value.length>0&&(ne.value=se.value[0].userName)}catch(e){console.error("닉네임 로드 실패:",e),se.value=le.map(e=>({userName:e,ouid:"",matches:[],stats:null,isDefault:!0}))}};y(se,e=>{e&&0!==e.length||ce()}),N(async()=>{if(console.log("감독모드 페이지 로드됨"),ce(),console.log("onMounted nicknames:",se.value),console.log("사용자 정보 로드 시작"),await we(),console.log("사용자 정보 로드 완료:",se.value.map(e=>({userName:e.userName,ouid:e.ouid}))),se.value.length>0){ne.value=se.value[0].userName;const e=se.value[0];e.ouid?(console.log(`${e.userName} 20게임 미리 계산된 통계 자동 로드`),await fe(e,20)):(console.log(`${e.userName}의 OUID가 없어서 실시간 데이터 로드`),await ve(e,!1))}de()});const de=async()=>{try{console.log("시즌 정보 로드 시작");const e=await ae.get("/api/fc/seasons");if(e.data.success&&e.data.data){const a={};e.data.data.forEach(e=>{a[e.seasonId]=e}),ie.value=a,console.log("시즌 정보 로드 완료:",Object.keys(a).length)}}catch(e){console.error("시즌 정보 로드 실패:",e)}},me=e=>{const a=ie.value[e];return a?a.className:`시즌 ${e}`},fe=async(e,a)=>{var t;if(e.ouid||(await we(),e.ouid))if(oe.value)console.log("이미 로딩 중입니다. 요청을 무시합니다.");else{oe.value=!0;try{console.log(`${e.userName} 미리 계산된 통계 로드 시작 (${a}게임)`);const t=await ae.get(`/api/fc/director/user-match-stats/${e.ouid}/${a}`);if(!t.data.success)return console.error(`${e.userName} 미리 계산된 통계 로드 실패:`,t.data.error),console.log(`${e.userName} 실시간 데이터 로드로 대체`),void(await ve(e,!1));{const a=t.data.data;console.log("미리 계산된 통계 응답:",a),e.matches=a.matches||[],e.matches.sort((e,a)=>new Date(a.matchDate)-new Date(e.matchDate)),e.stats=a.fcBrgStats||{},Ie.value[e.userName]=a.playerPerformanceStats||[],console.log(`${e.userName} 미리 계산된 통계 로드 완료: ${e.matches.length}경기, 선수 ${Ie.value[e.userName].length}명`),console.log("선수별 통계 샘플:",Ie.value[e.userName].slice(0,3))}}catch(l){return console.error(`${e.userName} 미리 계산된 통계 로드 오류:`,l),void(404===(null==(t=l.response)?void 0:t.status)?(console.log(`${e.userName} 해당 게임 수의 미리 계산된 통계가 없어서 실시간 데이터 로드`),await ve(e,!1)):(console.log(`${e.userName} 미리 계산된 통계 로드 오류로 실시간 데이터 로드`),await ve(e,!1)))}finally{oe.value=!1}}else alert("사용자 정보를 찾을 수 없습니다.")},ve=async(e,a=!1)=>{const t=re.value||20;if(e.ouid||(await we(),e.ouid))if(oe.value)console.log("이미 로딩 중입니다. 요청을 무시합니다.");else{oe.value=!0;try{console.log(`${e.userName} 감독모드 데이터 로드 시작 (limit: ${t})`);const a=await ae.post("/api/gamestat/matches",{targetOuid:e.ouid,matchType:52,limit:t,offset:0});if(a.data.success){e.stats=null,e.matches=[];const t=a.data.data;e.matches=t.map(a=>({...a,matchInfo:[{ouid:e.ouid,nickname:e.userName,shoot:{goalTotal:a.myGoals},matchDetail:{matchResult:a.result,matchEndType:"몰수승"===a.result?1:"몰수패"===a.result?2:0}},{ouid:"opponent",nickname:a.opponentTeamName,shoot:{goalTotal:a.opponentGoals},matchDetail:{matchResult:"승"===a.result?"패":"패"===a.result?"승":a.result,matchEndType:"몰수승"===a.result?2:"몰수패"===a.result?1:0}}]}));const l={win:0,draw:0,lose:0,error:0};t.forEach(e=>{"승"===e.result||"몰수승"===e.result?l.win++:"무"===e.result?l.draw++:"패"===e.result||"몰수패"===e.result?l.lose++:l.error++}),e.stats=l,e.matches.sort((e,a)=>new Date(a.matchDate)-new Date(e.matchDate)),console.log(`${e.userName} 감독모드 데이터 로드 완료: ${e.matches.length}경기`),await w(),ne.value||(ne.value=e.userName)}else console.error("감독모드 데이터 로드 실패:",a.data.error),alert(`데이터 조회 실패: ${a.data.error}`)}catch(l){console.error(`${e.userName} 감독모드 데이터 조회 실패:`,l),alert("데이터 조회 중 오류가 발생했습니다.")}finally{oe.value=!1}}else alert("사용자 정보를 찾을 수 없습니다.")},ge=(e,a)=>{switch(he(e,a)){case"승":return"blue-lighten-2";case"패":return"red-lighten-2";case"무":return"#888888";case"몰수승":return"orange-lighten-2";case"몰수패":return"deep-orange-lighten-2";case"오류":return"#E1BEE7";default:return"grey-lighten-2"}},he=(e,a)=>{var t,l;if(e.result)return e.result;const s=se.value.find(e=>e.userName===a);let o=null;return s&&s.ouid&&(o=null==(t=e.matchInfo)?void 0:t.find(e=>e.ouid===s.ouid)),o||(o=null==(l=e.matchInfo)?void 0:l.find(e=>e.nickname&&te(e.nickname,a))),o?pe(o,e.matchId):"오류"},pe=(e,a)=>{if(!e||!e.matchDetail)return console.log("매치 상세 정보 없음:",{userMatchInfo:e,matchId:a}),"오류";const t=e.matchDetail.matchResult,l=e.matchDetail.matchEndType;if(console.log("매치 결과 분석:",{result:t,matchEndType:l,matchId:a,userMatchInfo:e.matchDetail}),1===l)return"몰수승";if(2===l)return"몰수패";let s="오류";return"승"===t||"forfeit_win"===t||"win"===t?s="승":"무"===t||"draw"===t?s="무":"패"===t||"forfeit_lose"===t||"lose"===t?s="패":(console.log("알 수 없는 결과:",t),s="오류"),s},ye=(e,a)=>{var t,l;if(void 0!==e.myGoals&&void 0!==e.opponentGoals)return`${e.myGoals} : ${e.opponentGoals}`;if(!e.matchInfo||e.matchInfo.length<2)return"? : ?";const s=se.value.find(e=>e.userName===a);let o=-1;if(s&&s.ouid&&(o=e.matchInfo.findIndex(e=>e.ouid===s.ouid)),-1===o&&(o=e.matchInfo.findIndex(e=>e.nickname&&te(e.nickname,a))),-1===o)return"? : ?";return`${(null==(t=e.matchInfo[o].shoot)?void 0:t.goalTotal)||0} : ${(null==(l=e.matchInfo[1-o].shoot)?void 0:l.goalTotal)||0}`},Ne=(e,a)=>{if(e.opponentTeamName)return e.opponentTeamName;if(!e.matchInfo||e.matchInfo.length<2)return"알 수 없음";const t=se.value.find(e=>e.userName===a);let l,s=null;return t&&t.ouid&&(s=t.ouid),s&&(l=e.matchInfo.find(e=>e.ouid!==s)),l||(l=e.matchInfo.find(e=>e.nickname&&!te(e.nickname,a))),(null==l?void 0:l.nickname)||"알 수 없음"},we=async()=>{var e,a,t,l;try{const s=se.value.map(e=>e.userName);console.log("사용자 정보 조회 시작:",{nicknameList:s,currentNicknames:se.value.map(e=>({userName:e.userName,ouid:e.ouid}))});const o=await ae.post("/api/fc/users",{nicknames:s});console.log("서버 응답:",{success:null==(e=o.data)?void 0:e.success,data:null==(a=o.data)?void 0:a.data,dataLength:(null==(l=null==(t=o.data)?void 0:t.data)?void 0:l.length)||0}),o.data&&o.data.success&&Array.isArray(o.data.data)&&(o.data.data.forEach(e=>{console.log("사용자 데이터 처리:",{userData:e,nickName:e.nickName,ouid:e.ouid,userType:e.userType,source:e.source});const a=se.value.find(a=>te(a.userName,e.nickName));a&&e.ouid&&(console.log("ouid 업데이트:",{userName:a.userName,oldOuid:a.ouid,newOuid:e.ouid,userType:e.userType,source:e.source}),a.ouid=e.ouid,a.userType=e.userType||"알 수 없음",a.source=e.source||"알 수 없음")}),console.log("닉네임 저장 함수 호출됨 (localStorage 사용 안함)"),console.log("사용자 정보 조회 완료:",{updatedNicknames:se.value.map(e=>({userName:e.userName,ouid:e.ouid,userType:e.userType,source:e.source}))}))}catch(s){console.error("사용자 정보 조회 실패:",s)}};y(ne,async e=>{const a=se.value.find(a=>a.userName===e);a&&(a.ouid||(console.log(`${a.userName}의 OUID가 없어서 사용자 정보 로드`),await we()),a.ouid?(console.log(`탭 전환으로 인한 미리 계산된 통계 로드: ${a.userName} (${re.value}게임)`),await fe(a,re.value)):(console.log(`${a.userName}의 OUID가 없어서 실시간 데이터 로드`),await ve(a,!1)))});const _e=e=>{if(!e)return null;return{labels:["승","무","패","오류"],datasets:[{data:[e.win||0,e.draw||0,e.lose||0,e.error||0],backgroundColor:["#4CAF50","#FFC107","#F44336","#BDBDBD"],borderWidth:1}]}},ke={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},datalabels:{color:"#fff",font:{weight:"bold",size:14},formatter:(e,a)=>e>0?e:""}}};l.register(s,o,n,r,u,i,c,d,m,f);const xe=e=>{if(!e)return 0;const a=(e.win||0)+(e.draw||0)+(e.lose||0)+(e.error||0);if(0===a)return 0;return((e.win||0)/a*100).toFixed(1)},be=(e,a)=>{var t,l,s;const o=se.value.find(e=>e.userName===a);let n;o&&o.ouid&&(n=null==(t=e.matchInfo)?void 0:t.find(e=>e.ouid===o.ouid)),n||(n=null==(l=e.matchInfo)?void 0:l.find(e=>e.nickname&&te(e.nickname,a)));const r=null==(s=null==n?void 0:n.matchDetail)?void 0:s.matchEndType;return 1===r?"(몰수승)":2===r?"(몰수패)":""},Ie=h({}),$e=h(!1);return(e,a)=>{const t=_("v-icon"),l=_("v-card-title"),s=_("v-alert"),o=_("v-tab"),n=_("v-tabs"),r=_("v-select"),u=_("v-btn"),i=_("v-col"),c=_("v-row"),d=_("v-card-text"),m=_("v-card"),f=_("v-window-item"),h=_("v-window"),p=_("v-container"),y=_("v-img"),N=_("v-data-table");return k(),x(p,null,{default:b(()=>[I(c,{class:"mt-4"},{default:b(()=>[I(i,{cols:"12"},{default:b(()=>[I(m,{class:"mx-auto pa-4"},{default:b(()=>[I(l,{class:"d-flex align-center"},{default:b(()=>[I(t,{class:"mr-3",size:"large"},{default:b(()=>a[5]||(a[5]=[$("mdi-account-multiple")])),_:1,__:[5]}),a[6]||(a[6]=D("span",null,"전적 조회",-1))]),_:1,__:[6]}),I(s,{type:"info",variant:"tonal",class:"mb-4",border:"start",density:"compact"},{prepend:b(()=>[I(t,null,{default:b(()=>a[7]||(a[7]=[$("mdi-information")])),_:1,__:[7]})]),default:b(()=>[a[8]||(a[8]=D("div",{class:"text-body-2"},[D("p",null,[D("strong",null,"전적 조회:"),$(" 최근 경기 수에 맞춘 데이터 (실시간 계산)")]),D("p",null,[D("strong",null,"선수별 활약:"),$(" 전체 경기 누적 데이터 (DB 저장)")])],-1))]),_:1,__:[8]}),I(p,null,{default:b(()=>[I(n,{modelValue:ne.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ne.value=e),color:"primary","align-tabs":"start",class:"mb-4 nickname-tabs"},{default:b(()=>[(k(!0),T(V,null,j(se.value,e=>(k(),x(o,{key:e.userName,value:e.userName,class:"nickname-tab"},{default:b(()=>[e.isDefault?(k(),x(t,{key:0,size:"small",color:"primary",class:"mr-1"},{default:b(()=>a[9]||(a[9]=[$("mdi-star")])),_:1,__:[9]})):C("",!0),$(" "+E(e.userName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),I(h,{modelValue:ne.value,"onUpdate:modelValue":a[2]||(a[2]=e=>ne.value=e)},{default:b(()=>[(k(!0),T(V,null,j(se.value,e=>(k(),x(f,{key:e.userName,value:e.userName},{default:b(()=>{var l;return[D("div",A,[I(r,{modelValue:re.value,"onUpdate:modelValue":a[1]||(a[1]=e=>re.value=e),items:ue,label:"게임 수",style:{"max-width":"120px"},class:"mr-2",density:"compact",variant:"outlined","prepend-inner-icon":"mdi-gamepad-variant",hint:"미리 계산된 통계 사용","persistent-hint":""},null,8,["modelValue"]),I(u,{color:"info",variant:"outlined",size:"small",loading:oe.value,onClick:a=>ve(e,!0)},{default:b(()=>[I(t,{class:"mr-1"},{default:b(()=>a[10]||(a[10]=[$("mdi-refresh")])),_:1,__:[10]}),a[11]||(a[11]=$(" 화면 갱신 "))]),_:2,__:[11]},1032,["loading","onClick"])]),e&&Array.isArray(e.matches)&&e.matches.length>0?(k(),T("div",O,[I(c,{class:"mb-4 align-center justify-center"},{default:b(()=>[I(i,{cols:"auto"},{default:b(()=>{var a,t,l,s,o;return[D("div",z,[D("span",B,E((null==(a=e.stats)?void 0:a.win)||0)+"승",1),D("span",R,E((null==(t=e.stats)?void 0:t.draw)||0)+"무",1),D("span",G,E((null==(l=e.stats)?void 0:l.lose)||0)+"패",1),((null==(s=e.stats)?void 0:s.error)||0)>0?(k(),T("span",F,E((null==(o=e.stats)?void 0:o.error)||0)+"오류",1)):C("",!0)])]}),_:2},1024),I(i,{cols:"auto"},{default:b(()=>[D("div",L,[I(U(v),{data:_e(e.stats),options:ke},null,8,["data"])])]),_:2},1024),I(i,{cols:"auto",class:"d-flex align-center"},{default:b(()=>[D("div",S,[D("div",M,E(xe(e.stats))+"% ",1),a[12]||(a[12]=D("div",{class:"text-caption text-grey-darken-1"}," 승률 ",-1))])]),_:2},1024)]),_:2},1024),I(c,null,{default:b(()=>[(k(!0),T(V,null,j(e.matches,a=>(k(),x(i,{key:a.matchId,cols:"12",md:"4"},{default:b(()=>[I(m,{color:ge(a,e.userName),variant:"tonal",class:"match-card"},{default:b(()=>[I(d,null,{default:b(()=>{return[D("div",P,[D("div",q,E(he(a,e.userName))+" "+E(be(a,e.userName)),1),D("div",W,E((t=a.matchDate,g(t,"datetime"))),1)]),D("div",X,E(ye(a,e.userName)),1),D("div",H,E(e.userName)+" VS "+E(Ne(a,e.userName)),1)];var t}),_:2},1024)]),_:2},1032,["color"])]),_:2},1024))),128))]),_:2},1024),D("div",J," 현재 탭: "+E(e.userName)+", 매치 수: "+E((null==(l=e.matches)?void 0:l.length)||0),1)])):(k(),T("div",K,[I(t,{size:"48",color:"grey-lighten-1",class:"mb-2"},{default:b(()=>a[13]||(a[13]=[$("mdi-account-question")])),_:1,__:[13]}),D("div",Q,E(e.userName)+"의 전적 데이터가 없습니다. ",1)]))]}),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),I(c,{class:"mt-8"},{default:b(()=>[I(i,{cols:"12"},{default:b(()=>[I(m,{class:"mx-auto pa-4"},{default:b(()=>[I(l,{class:"text-h5 mb-4"},{default:b(()=>a[14]||(a[14]=[$("선수별 활약")])),_:1,__:[14]}),I(n,{modelValue:ne.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ne.value=e),class:"mb-4"},{default:b(()=>[(k(!0),T(V,null,j(se.value,e=>(k(),x(o,{key:e.userName,value:e.userName},{default:b(()=>[$(E(e.userName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),I(h,{modelValue:ne.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ne.value=e)},{default:b(()=>[(k(!0),T(V,null,j(se.value,e=>(k(),x(f,{key:e.userName,value:e.userName},{default:b(()=>{return[a[15]||(a[15]=D("div",{class:"d-flex justify-end mb-2"},null,-1)),I(N,{headers:[{title:"선수명",key:"name",align:"start"},{title:"시즌",key:"seasonImg",align:"center"},{title:"출전",key:"appearances",align:"end"},{title:"골",key:"totalGoals",align:"end"},{title:"도움",key:"assist",align:"end"},{title:"인터셉트",key:"intercept",align:"end"},{title:"수비",key:"defending",align:"end"},{title:"블록",key:"blockSuccess",align:"end"},{title:"태클",key:"tackle",align:"end"},{title:"옐로카드",key:"yellowCards",align:"end"},{title:"레드카드",key:"redCards",align:"end"},{title:"평균 평점",key:"spRating",align:"end"}],items:(t=e.userName,[...Ie.value[t]||[]].sort((e,a)=>a.spRating-e.spRating)),loading:$e.value,class:"elevation-1 rounded-lg",density:"comfortable",hover:"","no-data-text":"선수 활약 데이터가 없습니다."},{"item.seasonImg":b(({item:e})=>[D("div",Y,[e.seasonImg?(k(),x(y,{key:0,src:e.seasonImg,width:"24",height:"24",title:me(e.seasonId)},null,8,["src","title"])):C("",!0)])]),_:2},1032,["items","loading"])];var t}),_:2,__:[15]},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Z as default};
