import{_ as t,u as e,c as a}from"./admin-e8e59f4a.js";import{f as l}from"./timezone-f19b4e1b.js";import{e as o,c as s,f as n,r as i,o as r,a as c,w as d,b as m,i as u,g as p,t as h,h as v,j as y}from"./vendor-55a355ca.js";const f={key:0},w={class:"font-weight-bold text-primary"},g={class:"font-weight-bold text-success"},b={class:"font-weight-bold text-primary"},_={class:"font-weight-bold text-primary"},k={class:"font-weight-bold text-success"},x={key:1,class:"text-center py-8"},A=t({__name:"StatHis",setup(t){e();const A=a.create({baseURL:"localhost"===window.location.hostname?"http://localhost:3000":window.location.origin,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},withCredentials:!0});A.interceptors.request.use(t=>{const e=localStorage.getItem("token");return e&&(t.headers.Authorization=`Bearer ${e}`),t});const S=o(""),R=o("createdAt"),j=o(!1),E=o([]),P=o(null),T=o([]),z=[{title:"생성일 (최신순)",value:"createdAt"},{title:"승률 (높은순)",value:"winRate"},{title:"기대승점 (높은순)",value:"expectedPoints"}],C=[{title:"이름",key:"name",sortable:!0},{title:"승",key:"win",sortable:!0},{title:"무",key:"draw",sortable:!0},{title:"패",key:"lose",sortable:!0},{title:"오류",key:"nogame",sortable:!0},{title:"승률",key:"winRate",sortable:!0},{title:"기대승점",key:"expectedPoints",sortable:!0},{title:"경기타입",key:"matchType",sortable:!0},{title:"시작일",key:"matchStartAt",sortable:!0},{title:"종료일",key:"matchEndAt",sortable:!0},{title:"생성일",key:"createdAt",sortable:!0},{title:"작업",key:"actions",sortable:!1}],D=[{title:"이름",key:"name",sortable:!0},{title:"총 매치수",key:"totalMatches",sortable:!0},{title:"승",key:"win",sortable:!0},{title:"무",key:"draw",sortable:!0},{title:"패",key:"lose",sortable:!0},{title:"오류",key:"nogame",sortable:!0},{title:"승률",key:"winRate",sortable:!0},{title:"기대승점",key:"expectedPoints",sortable:!0}],V=s(()=>{if(!E.value.length)return[];const t=E.value.reduce((t,e)=>(t[e.name]||(t[e.name]={name:e.name,win:0,draw:0,lose:0,nogame:0}),t[e.name].win+=e.win||0,t[e.name].draw+=e.draw||0,t[e.name].lose+=e.lose||0,t[e.name].nogame+=e.nogame||0,t),{});return Object.values(t).map(t=>{const e=t.win+t.draw+t.lose+t.nogame,a=e>0?(t.win/e*100).toFixed(1):0,l=e>0?((3*t.win+1*t.draw)/e).toFixed(2):0;return{...t,totalMatches:e,winRate:parseFloat(a),expectedPoints:parseFloat(l)}}).sort((t,e)=>e.winRate-t.winRate)}),F=t=>{if(!t)return"-";console.log("formatDateTime 입력:",{dateString:t,type:typeof t,isDate:t instanceof Date});const e=l(t,"datetime");return console.log("formatDateTime 결과:",{input:t,output:e}),e},I=async()=>{if(S.value){j.value=!0;try{const t=await A.get("/api/gamestat/history",{params:{sortBy:R.value,sortOrder:"desc",targetNickname:S.value}});if(t.data.success){if(E.value=t.data.data,E.value.length>0){const t=E.value[0];console.log("StatHis 받은 데이터 샘플:",{matchStartAt:t.matchStartAt,matchStartAtType:typeof t.matchStartAt,matchStartAtInstance:t.matchStartAt instanceof Date,matchEndAt:t.matchEndAt,matchEndAtType:typeof t.matchEndAt,matchEndAtInstance:t.matchEndAt instanceof Date})}console.log("통계 히스토리 로드 완료:",E.value.length)}else console.error("통계 히스토리 로드 실패:",t.data.error)}catch(t){console.error("통계 히스토리 로드 오류:",t)}finally{j.value=!1}}};return n(async()=>{await(async()=>{try{const t=await A.get("/api/fc/users/default");t.data.success?(T.value=t.data.data.map(t=>t.nickName),console.log("기본 닉네임 목록 로드 완료:",T.value)):(console.error("기본 닉네임 목록 로드 실패:",t.data.error),T.value=["junspapa","junnypapa","마곡아이언맨","마곡퍼터맨","머니트렌드","절대월클아니다"])}catch(t){console.error("기본 닉네임 목록 로드 오류:",t),T.value=["junspapa","junnypapa","마곡아이언맨","마곡퍼터맨","머니트렌드","절대월클아니다"]}})(),T.value.length>0&&(S.value=T.value[0],await I())}),(t,e)=>{const a=i("v-card-title"),l=i("v-select"),o=i("v-col"),s=i("v-row"),n=i("v-card"),M=i("v-chip"),U=i("v-icon"),B=i("v-btn"),H=i("v-data-table"),N=i("v-container");return r(),c(N,{fluid:""},{default:d(()=>[m(s,null,{default:d(()=>[m(o,{cols:"12"},{default:d(()=>[m(n,{class:"mx-auto pa-4"},{default:d(()=>[m(a,{class:"text-h5 mb-4"},{default:d(()=>e[2]||(e[2]=[u("통계 히스토리")])),_:1,__:[2]}),m(n,{class:"mb-6 pa-4",variant:"outlined"},{default:d(()=>[m(s,null,{default:d(()=>[m(o,{cols:"12",md:"6"},{default:d(()=>[m(l,{modelValue:S.value,"onUpdate:modelValue":[e[0]||(e[0]=t=>S.value=t),I],items:T.value,label:"닉네임 선택",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),m(o,{cols:"12",md:"6"},{default:d(()=>[m(l,{modelValue:R.value,"onUpdate:modelValue":[e[1]||(e[1]=t=>R.value=t),I],items:z,label:"정렬 기준",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),E.value.length>0?(r(),p("div",f,[m(H,{headers:C,items:E.value,loading:j.value,class:"elevation-1 rounded-lg",density:"comfortable",hover:"","no-data-text":"저장된 통계가 없습니다."},{"item.matchType":d(({item:t})=>[m(M,{color:52===t.matchType?"primary":"secondary",size:"small",variant:"elevated"},{default:d(()=>[u(h(52===t.matchType?"감독모드":"공식경기"),1)]),_:2},1032,["color"])]),"item.winRate":d(({item:t})=>[v("span",w,h(t.winRate)+"%",1)]),"item.expectedPoints":d(({item:t})=>[v("span",g,h(t.expectedPoints),1)]),"item.matchStartAt":d(({item:t})=>[u(h(F(t.matchStartAt)),1)]),"item.matchEndAt":d(({item:t})=>[u(h(F(t.matchEndAt)),1)]),"item.createdAt":d(({item:t})=>[u(h(F(t.createdAt)),1)]),"item.actions":d(({item:t})=>[m(B,{color:"error",size:"small",variant:"outlined",onClick:e=>(async t=>{if(confirm("이 통계를 삭제하시겠습니까?")){P.value=t;try{const e=await A.delete(`/api/gamestat/${t}`);e.data.success?(alert("통계가 삭제되었습니다."),await I()):alert("삭제 실패: "+e.data.error)}catch(e){console.error("통계 삭제 오류:",e),alert("통계 삭제 중 오류가 발생했습니다.")}finally{P.value=null}}})(t._id),loading:P.value===t._id},{default:d(()=>[m(U,{size:"small"},{default:d(()=>e[3]||(e[3]=[u("mdi-delete")])),_:1,__:[3]})]),_:2},1032,["onClick","loading"])]),_:2},1032,["items","loading"]),m(n,{class:"mt-6 pa-4",variant:"outlined"},{default:d(()=>[m(a,{class:"text-h6 mb-4"},{default:d(()=>e[4]||(e[4]=[u("전술별 종합 통계")])),_:1,__:[4]}),m(H,{headers:D,items:V.value,class:"elevation-1 rounded-lg",density:"comfortable",hover:"","no-data-text":"종합 통계가 없습니다."},{"item.totalMatches":d(({item:t})=>[v("span",b,h(t.totalMatches)+"경기",1)]),"item.winRate":d(({item:t})=>[v("span",_,h(t.winRate)+"%",1)]),"item.expectedPoints":d(({item:t})=>[v("span",k,h(t.expectedPoints),1)]),_:2},1032,["items"])]),_:1})])):j.value?y("",!0):(r(),p("div",x,[m(U,{size:"48",color:"grey-lighten-1",class:"mb-2"},{default:d(()=>e[5]||(e[5]=[u("mdi-chart-line")])),_:1,__:[5]}),e[6]||(e[6]=v("div",{class:"text-body-1 text-medium-emphasis"}," 저장된 통계가 없습니다. ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})}}},[["__scopeId","data-v-fc9c3da9"]]);export{A as default};
