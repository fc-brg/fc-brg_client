import{e,c as a,f as t,r as l,o as s,a as o,w as n,b as u,i as r,j as c,g as i,h as d,t as v,m,F as f,k as p,q as g,p as h,s as y}from"./vendor-55a355ca.js";import{_,u as w,c as x}from"./admin-e8e59f4a.js";import{u as b}from"./fc-eba21898.js";import{C as k,A as I,p as V,a as S,b as C,c as j,d as D,L as A,P as N,e as O,B as T,f as F}from"./chartjs-plugin-datalabels.esm-e6c83794.js";import"./timezone-f19b4e1b.js";const U={key:0,class:"mb-6"},z={class:"d-flex align-center",style:{"font-size":"2.5em"}},M={class:"font-weight-bold text-primary"},B={class:"mx-2 font-weight-bold text-warning"},E={class:"font-weight-bold text-error"},L={key:0,class:"ml-2 font-weight-bold text-grey"},R={style:{width:"100px",height:"100px"}},q={class:"text-center"},G={class:"text-h4 font-weight-bold text-primary"},P={class:"text-center"},$={class:"text-h4 font-weight-bold text-success"},K={key:1},W={class:"d-flex align-center justify-space-between"},Z={class:"d-flex align-center",style:{"min-width":"60px"}},H={class:"text-caption text-grey-darken-1",style:{"min-width":"100px"}},J={class:"text-center flex-grow-1"},Q={class:"text-h6 mb-1 font-weight-bold"},X={class:"text-caption mb-2"},Y={class:"text-center",style:{"min-width":"80px"}},ee={key:2,class:"text-center py-8"},ae=_({__name:"GameStat",setup(_){const ae=w();b();const te=x.create({baseURL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3000":"fc-brg.github.io"===window.location.hostname?"https://fc-brg-server.onrender.com":window.location.origin,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},withCredentials:!0});te.interceptors.request.use(e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),e}),k.register(I,V,S,C,j,D,A,N,O,T);const le=e("52"),se=e(""),oe=e("100"),ne=e("0"),ue=e(!1),re=e([]),ce=e([]),ie=e(!1),de=e(!1),ve=e({name:"",category:"기타"}),me=["기타","시즌","월별","주별","커스텀"],fe=e([]),pe=e({}),ge=a(()=>ae.isLoggedIn),he=a(()=>{if(0===ce.value.length)return{win:0,draw:0,lose:0,nogame:0};const e=re.value.filter(e=>ce.value.includes(e.matchId));let a=0,t=0,l=0,s=0;return e.forEach(e=>{"승"===e.result||"몰수승"===e.result?a++:"무"===e.result?t++:"패"===e.result||"몰수패"===e.result?l++:s++}),{win:a,draw:t,lose:l,nogame:s}}),ye=a(()=>{const e=he.value.win+he.value.draw+he.value.lose;return 0===e?0:(he.value.win/e*100).toFixed(1)}),_e=a(()=>{const e=he.value.win+he.value.draw+he.value.lose;if(0===e)return 0;return((3*he.value.win+1*he.value.draw)/e).toFixed(1)}),we=a(()=>{const e=[he.value.win,he.value.draw,he.value.lose],a=["승","무","패"],t=["#4CAF50","#FFC107","#F44336"];return he.value.nogame>0&&(e.push(he.value.nogame),a.push("오류"),t.push("#BDBDBD")),{labels:a,datasets:[{data:e,backgroundColor:t,borderWidth:1}]}}),xe={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},datalabels:{color:"#fff",font:{weight:"bold",size:12},formatter:(e,a)=>e>0?e:""}}},be=e=>{switch(e){case"승":case"몰수승":return"blue-lighten-4";case"패":case"몰수패":return"red-lighten-4";case"무":return"grey-lighten-3";default:return"purple-lighten-4"}},ke=e=>{switch(e){case"승":case"몰수승":return"#1976d2";case"패":case"몰수패":return"#d32f2f";case"무":return"#f57c00";default:return"#7b1fa2"}},Ie=e=>{switch(e){case"승":case"몰수승":return"success";case"패":case"몰수패":return"error";case"무":return"warning";default:return"grey"}},Ve=async()=>{var e;if(!se.value)return void alert("닉네임을 선택해주세요.");console.log("매치 데이터 로드 시작:",{selectedNickname:se.value,userInfo:pe.value,userInfoKeys:Object.keys(pe.value)});const a=null==(e=pe.value[se.value])?void 0:e.ouid;if(console.log("targetOuid 조회 결과:",a),!a)return console.error("사용자 정보를 찾을 수 없음:",{selectedNickname:se.value,userInfo:pe.value,availableNicknames:Object.keys(pe.value)}),void alert("선택한 닉네임의 정보를 찾을 수 없습니다.");ue.value=!0;try{const e=await te.post("/api/gamestat/matches",{targetOuid:a,matchType:parseInt(le.value),limit:parseInt(oe.value),offset:parseInt(ne.value)});e.data.success?(re.value=e.data.data,ce.value=[],console.log("매치 데이터 로드 완료:",re.value.length),console.log("첫 번째 매치 데이터 샘플:",re.value[0])):alert("매치 데이터 로드 실패: "+e.data.error)}catch(t){console.error("매치 데이터 로드 오류:",t),alert("매치 데이터 로드 중 오류가 발생했습니다.")}finally{ue.value=!1}},Se=e=>{const a=ce.value.indexOf(e);if(a>-1)ce.value.splice(a,1);else{const a=re.value.findIndex(a=>a.matchId===e),t=ce.value.map(e=>re.value.findIndex(a=>a.matchId===e)).filter(e=>-1!==e);if(0===t.length)ce.value.push(e);else if(1===t.length){const e=t[0],l=a,s=Math.min(e,l),o=Math.max(e,l);ce.value=[];for(let a=s;a<=o;a++)ce.value.push(re.value[a].matchId)}else ce.value.push(e)}},Ce=e=>{const a=e.target.value;if(""!==a){const e=parseInt(a);e>=1&&e<=1e3&&(oe.value=e.toString())}},je=e=>{const a=e.target.value;if(""!==a){const e=parseInt(a);e>=0&&(ne.value=e.toString())}},De=()=>{ce.value=[]},Ae=async()=>{var e;if(!ve.value.name.trim())return void alert("저장할 이름을 입력해주세요.");if(0===ce.value.length)return void alert("저장할 매치를 선택해주세요.");const a=re.value.filter(e=>ce.value.includes(e.matchId));if(0===a.length)return void alert("선택된 매치 데이터가 없습니다.");const t=a.map(e=>(console.log("매치 데이터 디버깅:",{matchId:e.matchId,matchDate:e.matchDate,matchDateType:typeof e.matchDate,matchDateInstance:e.matchDate instanceof Date}),new Date(e.matchDate))),l=new Date(Math.min(...t.map(e=>e.getTime()))),s=new Date(Math.max(...t.map(e=>e.getTime())));console.log("날짜 범위 계산:",{selectedMatches:ce.value.length,matchStartAt:l.toISOString(),matchEndAt:s.toISOString(),originalDates:t.map(e=>e.toISOString())}),de.value=!0;try{const a=await te.post("/api/gamestat/save",{name:ve.value.name,category:ve.value.category,win:he.value.win,draw:he.value.draw,lose:he.value.lose,nogame:he.value.nogame,matchStartAt:l.toISOString(),matchEndAt:s.toISOString(),winRate:parseFloat(ye.value),expectedPoints:parseFloat(_e.value),matchType:parseInt(le.value),targetOuid:null==(e=pe.value[se.value])?void 0:e.ouid,targetNickname:se.value,selectedMatches:ce.value});a.data.success?(alert("통계가 저장되었습니다."),ie.value=!1,ve.value.name="",ve.value.category="기타"):alert("저장 실패: "+a.data.error)}catch(o){console.error("통계 저장 오류:",o),alert("통계 저장 중 오류가 발생했습니다.")}finally{de.value=!1}};return t(async()=>{await(async()=>{try{const e=await te.get("/api/fc/users/default");e.data.success?(fe.value=e.data.data.map(e=>e.nickName),console.log("기본 닉네임 목록 로드 완료:",fe.value)):(console.error("기본 닉네임 목록 로드 실패:",e.data.error),fe.value=["junspapa","junnypapa","마곡아이언맨","마곡퍼터맨","머니트렌드","절대월클아니다"])}catch(e){console.error("기본 닉네임 목록 로드 오류:",e),fe.value=["junspapa","junnypapa","마곡아이언맨","마곡퍼터맨","머니트렌드","절대월클아니다"]}})(),await(async()=>{try{if(0===fe.value.length)return void console.log("기본 닉네임 목록이 비어있어 사용자 정보 로드를 건너뜁니다.");const e=fe.value;console.log("사용자 정보 로드 시작:",e);const a=await te.post("/api/fc/users",{nicknames:e});console.log("서버 응답:",a.data),a.data&&a.data.success&&Array.isArray(a.data.data)?(a.data.data.filter(a=>e.includes(a.nickName)).forEach(e=>{console.log("사용자 데이터 처리:",e),e.nickName&&e.ouid?(pe.value[e.nickName]={ouid:e.ouid,userType:e.userType,source:e.source},console.log(`사용자 정보 저장: ${e.nickName} -> ${e.ouid}`)):console.warn("유효하지 않은 사용자 데이터:",e)}),console.log("사용자 정보 로드 완료:",pe.value)):console.error("서버 응답이 올바르지 않습니다:",a.data)}catch(e){console.error("사용자 정보 로드 실패:",e)}})(),fe.value.length>0&&(se.value=fe.value[0])}),(e,a)=>{const t=l("v-card-title"),_=l("v-tab"),w=l("v-tabs"),x=l("v-col"),b=l("v-select"),k=l("v-text-field"),I=l("v-icon"),V=l("v-btn"),S=l("v-row"),C=l("v-card"),j=l("v-checkbox"),D=l("v-chip"),A=l("v-card-text"),N=l("v-spacer"),O=l("v-card-actions"),T=l("v-dialog"),ae=l("v-container");return s(),o(ae,{fluid:""},{default:n(()=>[u(S,null,{default:n(()=>[u(x,{cols:"12"},{default:n(()=>[u(C,{class:"mx-auto pa-4"},{default:n(()=>[u(t,{class:"text-h5 mb-4"},{default:n(()=>a[10]||(a[10]=[r("게임 통계")])),_:1,__:[10]}),u(C,{class:"mb-6 pa-4",variant:"outlined"},{default:n(()=>[u(S,null,{default:n(()=>[u(x,{cols:"12",md:"6"},{default:n(()=>[u(w,{modelValue:le.value,"onUpdate:modelValue":a[0]||(a[0]=e=>le.value=e),class:"mb-4"},{default:n(()=>[u(_,{value:"52"},{default:n(()=>a[11]||(a[11]=[r("감독모드")])),_:1,__:[11]}),u(_,{value:"50"},{default:n(()=>a[12]||(a[12]=[r("공식경기")])),_:1,__:[12]})]),_:1},8,["modelValue"])]),_:1}),u(x,{cols:"12",md:"6"},{default:n(()=>[u(b,{modelValue:se.value,"onUpdate:modelValue":a[1]||(a[1]=e=>se.value=e),items:fe.value,label:"닉네임 선택",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),u(x,{cols:"12",md:"3"},{default:n(()=>[u(k,{modelValue:oe.value,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value=e),type:"number",label:"경기수",min:"1",max:"1000",variant:"outlined",density:"compact",onInput:Ce},null,8,["modelValue"])]),_:1}),u(x,{cols:"12",md:"3"},{default:n(()=>[u(k,{modelValue:ne.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ne.value=e),type:"number",label:"시작 위치",min:"0",variant:"outlined",density:"compact",onInput:je},null,8,["modelValue"])]),_:1}),u(x,{cols:"12",md:"6",class:"d-flex align-center"},{default:n(()=>[u(V,{color:"primary",loading:ue.value,onClick:Ve,class:"mr-2"},{default:n(()=>[u(I,{class:"mr-1"},{default:n(()=>a[13]||(a[13]=[r("mdi-magnify")])),_:1,__:[13]}),a[14]||(a[14]=r(" 조회 "))]),_:1,__:[14]},8,["loading"]),ge.value?(s(),o(V,{key:0,color:"success",disabled:0===ce.value.length,onClick:a[4]||(a[4]=e=>ie.value=!0)},{default:n(()=>[u(I,{class:"mr-1"},{default:n(()=>a[15]||(a[15]=[r("mdi-content-save")])),_:1,__:[15]}),a[16]||(a[16]=r(" 저장 "))]),_:1,__:[16]},8,["disabled"])):c("",!0)]),_:1})]),_:1})]),_:1}),ce.value.length>0?(s(),i("div",U,[u(C,{class:"pa-4",variant:"outlined"},{default:n(()=>[u(t,{class:"text-h6 mb-4"},{default:n(()=>a[17]||(a[17]=[r("선택된 게임 통계")])),_:1,__:[17]}),u(S,{class:"align-center justify-center"},{default:n(()=>[u(x,{cols:"auto"},{default:n(()=>[d("div",z,[d("span",M,v(he.value.win)+"승",1),d("span",B,v(he.value.draw)+"무",1),d("span",E,v(he.value.lose)+"패",1),he.value.nogame>0?(s(),i("span",L,v(he.value.nogame)+"오류",1)):c("",!0)])]),_:1}),u(x,{cols:"auto"},{default:n(()=>[d("div",R,[u(m(F),{data:we.value,options:xe},null,8,["data"])])]),_:1}),u(x,{cols:"auto",class:"d-flex align-center"},{default:n(()=>[d("div",q,[d("div",G,v(ye.value)+"% ",1),a[18]||(a[18]=d("div",{class:"text-caption text-grey-darken-1"}," 승률 ",-1))])]),_:1}),u(x,{cols:"auto",class:"d-flex align-center"},{default:n(()=>[d("div",P,[d("div",$,v(_e.value),1),a[19]||(a[19]=d("div",{class:"text-caption text-grey-darken-1"}," 기대승점 ",-1))])]),_:1})]),_:1})]),_:1})])):c("",!0),re.value.length>0?(s(),i("div",K,[u(t,{class:"text-h6 mb-4 d-flex justify-space-between"},{default:n(()=>[d("span",null,"매치 목록 ("+v(re.value.length)+"경기)",1),ce.value.length>0?(s(),o(V,{key:0,color:"info",variant:"outlined",size:"small",onClick:De},{default:n(()=>a[20]||(a[20]=[r(" 선택 해제 ")])),_:1,__:[20]})):c("",!0)]),_:1}),u(S,null,{default:n(()=>[(s(!0),i(f,null,p(re.value,(e,t)=>(s(),o(x,{key:e.matchId,cols:"12"},{default:n(()=>[u(C,{color:be(e.result),variant:"elevated",class:g(["match-card mb-2",{"selected-match":ce.value.includes(e.matchId)}]),onClick:a=>Se(e.matchId),style:h([{"border-left":"4px solid"},{"border-left-color":ke(e.result)}])},{default:n(()=>[u(A,{class:"py-3"},{default:n(()=>{return[d("div",W,[d("div",Z,[u(j,{"model-value":ce.value.includes(e.matchId),onClick:a[5]||(a[5]=y(()=>{},["stop"])),onChange:a=>Se(e.matchId),"hide-details":"",density:"compact",color:"primary",class:"match-checkbox"},null,8,["model-value","onChange"])]),d("div",H,v((t=e.matchDate,new Date(t).toLocaleString("ko-KR",{timeZone:"Asia/Seoul",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\. /g,"월 ").replace(/\./g,"일 "))),1),d("div",J,[d("div",Q,v(e.myGoals)+" VS "+v(e.opponentGoals),1),d("div",X,v(e.myTeamName)+" VS "+v(e.opponentTeamName),1)]),d("div",Y,[u(D,{color:Ie(e.result),size:"small",variant:"elevated",class:"font-weight-bold"},{default:n(()=>[r(v(e.result),1)]),_:2},1032,["color"])])])];var t}),_:2},1024)]),_:2},1032,["color","onClick","class","style"])]),_:2},1024))),128))]),_:1})])):ue.value?c("",!0):(s(),i("div",ee,[u(I,{size:"48",color:"grey-lighten-1",class:"mb-2"},{default:n(()=>a[21]||(a[21]=[r("mdi-gamepad-variant")])),_:1,__:[21]}),a[22]||(a[22]=d("div",{class:"text-body-1 text-medium-emphasis"}," 조회 버튼을 눌러 매치 데이터를 불러오세요. ",-1))]))]),_:1})]),_:1})]),_:1}),u(T,{modelValue:ie.value,"onUpdate:modelValue":a[9]||(a[9]=e=>ie.value=e),"max-width":"500px"},{default:n(()=>[u(C,null,{default:n(()=>[u(t,null,{default:n(()=>a[23]||(a[23]=[r("통계 저장")])),_:1,__:[23]}),u(A,null,{default:n(()=>[u(k,{modelValue:ve.value.name,"onUpdate:modelValue":a[6]||(a[6]=e=>ve.value.name=e),label:"저장할 이름",variant:"outlined",required:""},null,8,["modelValue"]),u(b,{modelValue:ve.value.category,"onUpdate:modelValue":a[7]||(a[7]=e=>ve.value.category=e),items:me,label:"카테고리",variant:"outlined"},null,8,["modelValue"])]),_:1}),u(O,null,{default:n(()=>[u(N),u(V,{onClick:a[8]||(a[8]=e=>ie.value=!1)},{default:n(()=>a[24]||(a[24]=[r("취소")])),_:1,__:[24]}),u(V,{color:"primary",onClick:Ae,loading:de.value},{default:n(()=>a[25]||(a[25]=[r("저장")])),_:1,__:[25]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},[["__scopeId","data-v-7f551858"]]);export{ae as default};
