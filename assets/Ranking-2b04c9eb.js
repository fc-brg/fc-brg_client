import{_ as e,c as a}from"./admin-a72e56d8.js";import{f as t}from"./timezone-f19b4e1b.js";import{e as l,c as n,f as r,r as i,o,a as s,w as c,b as d,i as u,h as _,t as m,g as f,F as k,k as v,j as g,q as h}from"./vendor-55a355ca.js";const b={class:"d-flex align-center"},p={class:"text-caption"},y={key:0},x={class:"text-caption"},w={class:"d-flex align-center justify-space-between mb-1"},D={class:"d-flex align-center"},R={class:"text-caption mb-1"},N={key:0},C={class:"text-h4 font-weight-bold primary--text mb-2"},H={key:0},S={key:1},j={class:"text-caption grey--text"};const z=e({name:"Ranking",setup(){const e=l([]),i=l([]),o=l(""),s=l([]),c=l(!1);function d(e){const a=e&&e.match(/ico_rank(\d+)/);return a?parseInt(a[1],10):99}const u=n(()=>i.value.length>0?i.value[0].icon_rank:null),_=n(()=>i.value.length>0?i.value[i.value.length-1].in_date:null);return r(()=>{(async()=>{try{c.value=!0;const t=await a.get("/api/friends/latest");e.value=t.data,s.value=[...new Set(t.data.map(e=>e.nickname))]}catch(t){console.error("최신 데이터 로드 실패:",t)}finally{c.value=!1}})()}),{latestFriends:e,historyData:i,selectedNickname:o,availableNicknames:s,loading:c,latestHeaders:[{text:"닉네임",value:"nickname",sortable:!0},{text:"등급",value:"icon_rank",sortable:!0},{text:"레벨",value:"level",sortable:!0},{text:"접속상태",value:"access_on",sortable:!0},{text:"조회일",value:"in_date",sortable:!0}],loadHistory:async()=>{if(o.value)try{c.value=!0;const e=(await a.get(`/api/friends/history/${encodeURIComponent(o.value)}`)).data,t=e.filter((a,t)=>{if(t===e.length-1)return!0;const l=e[t+1];return a.icon_rank!==l.icon_rank||a.level!==l.level});i.value=t}catch(e){console.error("히스토리 데이터 로드 실패:",e),i.value=[]}finally{c.value=!1}else i.value=[]},formatDate:e=>t(e,"datetime"),getRankColor:e=>({"슈퍼챔피언스":"super-champion","챔피언스":"red darken-1","슈퍼챌린지":"green darken-3","챌린지1부":"green darken-2","챌린지2부":"green darken-1","챌린지3부":"green","프로 1부":"amber darken-3","프로 2부":"amber darken-2","프로 3부":"amber darken-1","세미프로 1부":"light-blue darken-2","세미프로 2부":"light-blue darken-1","세미프로 3부":"light-blue","월드클래스 1부":"blue-grey darken-2","월드클래스 2부":"blue-grey darken-1","월드클래스 3부":"blue-grey","배치":"grey"}[e]||"grey"),getChangeDescription:(e,a)=>{if(!e||!a)return null;if(e.icon_rank!==a.icon_rank){const t=rankOrder[e.icon_rank]||99,l=rankOrder[a.icon_rank]||99;let n="",r="";return t>l?(n="up",r="up"):t<l&&(n="down",r="down"),{direction:n,color:r,message:`등급: ${e.icon_rank} → ${a.icon_rank}`}}return null},currentRank:u,firstSeen:_,getRankNumber:d,getTimelineDotColor:function(e){if(e<i.value.length-1){const a=i.value[e],t=i.value[e+1];if(d(a.icon_rank_url)<d(t.icon_rank_url))return"primary";if(d(a.icon_rank_url)>d(t.icon_rank_url))return"error"}return"grey"},getTimelineDotStyle:function(e){let a="#bdbdbd";if(e<i.value.length-1){const t=i.value[e],l=i.value[e+1];d(t.icon_rank_url)<d(l.icon_rank_url)?a="#1976d2":d(t.icon_rank_url)>d(l.icon_rank_url)&&(a="#d32f2f")}return{backgroundColor:a,borderColor:a,width:"10px",height:"10px",minWidth:"10px",minHeight:"10px",maxWidth:"10px",maxHeight:"10px",boxShadow:"0 2px 6px rgba(0,0,0,0.2)",borderRadius:"50%",borderWidth:"2px",borderStyle:"solid",zIndex:2}},getTimelineDotColorHex:function(e){if(e<i.value.length-1){const a=i.value[e],t=i.value[e+1];if(d(a.icon_rank_url)<d(t.icon_rank_url))return"#1976d2";if(d(a.icon_rank_url)>d(t.icon_rank_url))return"#d32f2f"}return"#bdbdbd"}}}},[["render",function(e,a,t,l,n,r){const z=i("v-icon"),F=i("v-card-title"),I=i("v-card"),T=i("v-img"),V=i("v-avatar"),O=i("v-chip"),U=i("v-data-table"),W=i("v-card-text"),$=i("v-select"),q=i("v-col"),A=i("v-row"),B=i("v-timeline-item"),E=i("v-timeline"),G=i("v-divider"),J=i("v-alert"),K=i("v-container");return o(),s(K,{fluid:"",class:"pa-6"},{default:c(()=>[d(A,null,{default:c(()=>[d(q,{cols:"12"},{default:c(()=>[d(I,{class:"mb-6"},{default:c(()=>[d(F,{class:"text-h4 font-weight-bold primary--text"},{default:c(()=>[d(z,{large:"",class:"mr-3"},{default:c(()=>a[1]||(a[1]=[u("mdi-trophy")])),_:1,__:[1]}),a[2]||(a[2]=u(" FC Online 등급 현황 "))]),_:1,__:[2]})]),_:1}),d(I,{class:"mb-6"},{default:c(()=>[d(F,{class:"text-h5 font-weight-medium"},{default:c(()=>[d(z,{class:"mr-2"},{default:c(()=>a[3]||(a[3]=[u("mdi-account-group")])),_:1,__:[3]}),a[4]||(a[4]=u(" 최근 등급 현황 "))]),_:1,__:[4]}),d(W,null,{default:c(()=>[d(U,{headers:l.latestHeaders,items:l.latestFriends,loading:l.loading,"items-per-page":10,class:"elevation-1","hide-default-footer":""},{"item.icon_rank":c(({item:e})=>[_("div",b,[d(V,{size:"24",class:"mr-2"},{default:c(()=>[e.icon_rank_url?(o(),s(T,{key:0,src:e.icon_rank_url,alt:e.icon_rank},null,8,["src","alt"])):(o(),s(z,{key:1},{default:c(()=>a[5]||(a[5]=[u("mdi-trophy-outline")])),_:1,__:[5]}))]),_:2},1024),d(O,{color:l.getRankColor(e.icon_rank),"text-color":"white",small:"",label:""},{default:c(()=>[u(m(e.icon_rank),1)]),_:2},1032,["color"])])]),"item.access_on":c(({item:e})=>[d(O,{color:"접속중"===e.access_on?"success":"grey","text-color":"white",small:"",label:""},{default:c(()=>[d(z,{left:"",small:""},{default:c(()=>[u(m("접속중"===e.access_on?"mdi-circle":"mdi-circle-outline"),1)]),_:2},1024),u(" "+m(e.access_on),1)]),_:2},1032,["color"])]),"item.in_date":c(({item:e})=>[_("span",p,m(l.formatDate(e.in_date)),1)]),_:1},8,["headers","items","loading"])]),_:1})]),_:1}),d(I,null,{default:c(()=>[d(F,{class:"text-h5 font-weight-medium"},{default:c(()=>[d(z,{class:"mr-2"},{default:c(()=>a[6]||(a[6]=[u("mdi-history")])),_:1,__:[6]}),a[7]||(a[7]=u(" 등급 히스토리 "))]),_:1,__:[7]}),d(W,null,{default:c(()=>[d(A,{class:"mb-4"},{default:c(()=>[d(q,{cols:"12",md:"6"},{default:c(()=>[d($,{modelValue:l.selectedNickname,"onUpdate:modelValue":[a[0]||(a[0]=e=>l.selectedNickname=e),l.loadHistory],items:l.availableNicknames,label:"닉네임 선택","prepend-icon":"mdi-account",clearable:"",outlined:"",dense:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})]),_:1}),l.historyData.length>0?(o(),f("div",y,[d(A,null,{default:c(()=>[d(q,{cols:"12",md:"8"},{default:c(()=>[d(E,{dense:""},{default:c(()=>[(o(!0),f(k,null,v(l.historyData,(e,t)=>(o(),s(B,{key:e._id,color:l.getTimelineDotColorHex(t),small:"","fill-dot":"",class:"custom-timeline-item"},{opposite:c(()=>[_("span",x,m(l.formatDate(e.in_date)),1)]),default:c(()=>[d(I,{class:"elevation-2 timeline-card"},{default:c(()=>[d(W,{class:"pa-4"},{default:c(()=>[_("div",w,[_("div",D,[d(V,{size:"32",class:"mr-3"},{default:c(()=>[e.icon_rank_url?(o(),s(T,{key:0,src:e.icon_rank_url,alt:e.icon_rank},null,8,["src","alt"])):(o(),s(z,{key:1},{default:c(()=>a[8]||(a[8]=[u("mdi-trophy-outline")])),_:1,__:[8]}))]),_:2},1024),d(O,{color:l.getRankColor(e.icon_rank),"text-color":"white",small:"",label:"",class:"mb-0"},{default:c(()=>[u(m(e.icon_rank),1)]),_:2},1032,["color"])]),d(O,{color:"접속중"===e.access_on?"success":"grey","text-color":"white",small:"",label:""},{default:c(()=>[d(z,{left:"","x-small":""},{default:c(()=>[u(m("접속중"===e.access_on?"mdi-circle":"mdi-circle-outline"),1)]),_:2},1024),u(" "+m(e.access_on),1)]),_:2},1032,["color"])]),_("div",R,"레벨: "+m(e.level||"-"),1),t<l.historyData.length-1?(o(),f("div",N,[l.getRankNumber(e.icon_rank_url)!==l.getRankNumber(l.historyData[t+1].icon_rank_url)?(o(),f("span",{key:0,class:h(l.getRankNumber(e.icon_rank_url)<l.getRankNumber(l.historyData[t+1].icon_rank_url)?"change-indicator-up":"change-indicator-down")},m(l.getRankNumber(e.icon_rank_url)<l.getRankNumber(l.historyData[t+1].icon_rank_url)?"▲":"▼")+" "+m(l.historyData[t+1].icon_rank)+" → "+m(e.icon_rank),3)):g("",!0)])):g("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["color"]))),128))]),_:1})]),_:1}),d(q,{cols:"12",md:"4"},{default:c(()=>[d(I,{class:"elevation-2"},{default:c(()=>[d(F,{class:"text-h6"},{default:c(()=>[d(z,{class:"mr-2"},{default:c(()=>a[9]||(a[9]=[u("mdi-chart-line")])),_:1,__:[9]}),a[10]||(a[10]=u(" 통계 "))]),_:1,__:[10]}),d(W,null,{default:c(()=>[_("div",C,m(l.historyData.length),1),a[13]||(a[13]=_("div",{class:"text-caption grey--text"},"총 기록 수",-1)),d(G,{class:"my-3"}),l.currentRank?(o(),f("div",H,[a[11]||(a[11]=_("div",{class:"text-subtitle-2 font-weight-medium"},"현재 등급",-1)),d(O,{color:l.getRankColor(l.currentRank),"text-color":"white",small:"",label:"",class:"mt-1"},{default:c(()=>[u(m(l.currentRank),1)]),_:1},8,["color"])])):g("",!0),d(G,{class:"my-3"}),l.firstSeen?(o(),f("div",S,[a[12]||(a[12]=_("div",{class:"text-subtitle-2 font-weight-medium"},"첫 기록",-1)),_("div",j,m(l.formatDate(l.firstSeen)),1)])):g("",!0)]),_:1,__:[13]})]),_:1})]),_:1})]),_:1})])):l.selectedNickname?(o(),s(J,{key:1,type:"info",outlined:"",class:"text-center"},{default:c(()=>[d(z,{large:"",class:"mb-2"},{default:c(()=>a[14]||(a[14]=[u("mdi-information-outline")])),_:1,__:[14]}),a[15]||(a[15]=_("div",{class:"text-h6"},"히스토리 데이터가 없습니다",-1)),a[16]||(a[16]=_("div",{class:"text-caption"},"선택한 닉네임의 등급 히스토리가 없습니다.",-1))]),_:1,__:[15,16]})):(o(),s(J,{key:2,type:"info",outlined:"",class:"text-center"},{default:c(()=>[d(z,{large:"",class:"mb-2"},{default:c(()=>a[17]||(a[17]=[u("mdi-account-search")])),_:1,__:[17]}),a[18]||(a[18]=_("div",{class:"text-h6"},"닉네임을 선택해주세요",-1)),a[19]||(a[19]=_("div",{class:"text-caption"},"위에서 닉네임을 선택하면 등급 히스토리를 확인할 수 있습니다.",-1))]),_:1,__:[18,19]}))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-71f57d15"]]);export{z as default};
